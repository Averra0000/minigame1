<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Aim Game - Toilet Edition</title>
    <style>
        body { 
            margin: 0; overflow: hidden; background: #000; color: white; font-family: sans-serif; 
            /* 背景图设置 */
            background-image: url('bg.jpg'); 
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        canvas { display: block; }
        .ui { position: absolute; top: 20px; left: 20px; width: 280px; pointer-events: none; }
        .bar-container { 
            background: rgba(0, 0, 0, 0.7); padding: 12px; border-radius: 8px; margin-bottom: 12px; 
            border: 1px solid rgba(0, 212, 255, 0.3); backdrop-filter: blur(5px);
        }
        .label { font-size: 13px; margin-bottom: 6px; display: flex; justify-content: space-between; font-weight: bold; }
        .progress { background: #1a1a1a; height: 14px; border-radius: 7px; overflow: hidden; border: 1px solid #333; }
        #pee-fill { height: 100%; background: #00d4ff; width: 0%; transition: width 0.1s; box-shadow: 0 0 15px #00d4ff; }
        #floor-fill { height: 100%; background: #005a7a; width: 0%; transition: width 0.1s; }
    </style>
</head>
<body>

    <div class="ui">
        <div class="bar-container">
            <div class="label">PEE BAR (TARGET) <span id="p1">0%</span></div>
            <div class="progress"><div id="pee-fill"></div></div>
        </div>
        <div class="bar-container">
            <div class="label">FLOOR BAR (FAIL) <span id="p2">0%</span></div>
            <div class="progress"><div id="floor-fill"></div></div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // --- 【对齐配置：根据你的图片进行了预设】 ---
    const TARGET_ZONE = {
        w: 130,       // 马桶中心区域宽度
        h: 130,       // 马桶中心区域高度
        offsetX: 0,   // 左右偏移
        offsetY: -80  // 负数代表向上移动，对准背景图里的马桶
    };

    let bar1 = 0, bar2 = 0;
    let isGameOver = false;
    
    let waterPos = { x: 0, y: 0 };
    let drift = { x: 0, y: 0 };
    const keys = {};
    let particles = [];

    // 音效
    const winSound = new Audio('win.mp3');
    const failSound = new Audio('fail.mp3');

    class Drip {
        constructor() {
            this.progress = 0;
            this.speed = 0.05 + Math.random() * 0.02;
            this.startX = canvas.width / 2;
            this.startY = canvas.height + 20;
            this.tx = waterPos.x + (Math.random()-0.5) * 15;
            this.ty = waterPos.y + (Math.random()-0.5) * 15;
        }
        update() {
            this.progress += this.speed;
            this.currX = this.startX + (this.tx - this.startX) * this.progress;
            this.currY = this.startY + (this.ty - this.startY) * this.progress - Math.sin(this.progress * Math.PI) * 120;
        }
        draw() {
            let size = 1 + (1 - this.progress) * 10;
            ctx.fillStyle = `rgba(0, 212, 255, ${1 - this.progress})`;
            ctx.beginPath(); ctx.arc(this.currX, this.currY, size, 0, Math.PI * 2); ctx.fill();
        }
    }

    function init() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        waterPos.x = (canvas.width / 2) + TARGET_ZONE.offsetX;
        waterPos.y = (canvas.height / 2) + TARGET_ZONE.offsetY;
    }
    window.addEventListener('resize', init);
    init();

    window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    function loop() {
        if (isGameOver) return;

        drift.x += (Math.random() - 0.5) * 1.5;
        drift.y += (Math.random() - 0.5) * 1.5;
        waterPos.x += drift.x;
        waterPos.y += drift.y;
        drift.x *= 0.96; drift.y *= 0.96;

        const moveSpeed = 7;
        if (keys['w'] || keys['arrowup'])    waterPos.y -= moveSpeed;
        if (keys['s'] || keys['arrowdown'])  waterPos.y += moveSpeed;
        if (keys['a'] || keys['arrowleft'])  waterPos.x -= moveSpeed;
        if (keys['d'] || keys['arrowright']) waterPos.x += moveSpeed;

        for(let i=0; i<3; i++) particles.push(new Drip());

        const tx = (canvas.width / 2) - (TARGET_ZONE.w / 2) + TARGET_ZONE.offsetX;
        const ty = (canvas.height / 2) - (TARGET_ZONE.h / 2) + TARGET_ZONE.offsetY;
        const inTarget = waterPos.x > tx && waterPos.x < tx + TARGET_ZONE.w &&
                         waterPos.y > ty && waterPos.y < ty + TARGET_ZONE.h;
        
        if (inTarget) bar1 += 0.2; else bar2 += 0.6;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 目标辅助线（可选，对齐后可以把 alpha 设为 0）
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
        ctx.strokeRect(tx, ty, TARGET_ZONE.w, TARGET_ZONE.h);

        particles.forEach((p, i) => {
            p.update(); p.draw();
            if (p.progress >= 1) particles.splice(i, 1);
        });

        document.getElementById('pee-fill').style.width = Math.min(bar1, 100) + '%';
        document.getElementById('floor-fill').style.width = Math.min(bar2, 100) + '%';
        document.getElementById('p1').innerText = Math.floor(bar1) + '%';
        document.getElementById('p2').innerText = Math.floor(bar2) + '%';

        if (bar1 >= 100) { winSound.play(); alert("SUCCESS!"); location.reload(); isGameOver = true; }
        if (bar2 >= 100) { failSound.play(); alert("FAILED!"); location.reload(); isGameOver = true; }

        requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
</script>
</body>
</html>
